<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>SCALPER ASSISTANT · FINAL A++ (FIELD SAFE + PRICE MISSION ASSIST)</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
/* === ORIGINAL CSS — TIDAK DIUBAH === */
body{margin:0;background:#000;color:#00ff99;font-family:Consolas,monospace}
#top{padding:8px;border-bottom:1px solid #222;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
select,button,input{background:#111;color:#fff;border:1px solid #444;padding:6px;font-family:Consolas}
button.active{background:#003322;border-color:#00ff99}
button.early{border-color:#00ff99}
button.standby{border-color:#ffaa00}
button.late{border-color:#ff4444}
#status{font-weight:bold}
#mode{color:#ffaa00;font-weight:bold}
#session{color:#00bfff;font-weight:bold}
#tvWrap{position:relative}
#tv{width:100%;height:38vh;border:none}
#overlay{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none}
.line{position:absolute;left:0;right:0;height:1px}
.line.m15{background:#ffff00}
.line.m30{background:#00bfff}
.line.h1{background:#bf00ff}
#panel{height:62vh;overflow:auto;padding:8px}
.section{border:1px solid #333;margin-bottom:8px;padding:8px;background:#070707}
.zone{margin-top:6px;padding:6px;border:1px dashed #00ffff;color:#00ffff}
.warn{color:#ff4444}
.info{color:#ffaa00}
.ok{color:#00ff99}
.ctx{white-space:pre-line}
.hidden{display:none}
.score{margin-top:4px}
</style>
</head>

<body>

<div id="top">
<b>PAIR</b>
<select id="pair">
<option>BTCUSDT</option>
<option>XAUUSD</option>
</select>
<span id="mode">MODE: SNIPER</span>
<span id="session">SESSION: -</span>
<b id="status">BOOT</b>
<button id="toggleReason">SHOW</button>
</div>

<div id="tvWrap">
<iframe id="tv"></iframe>
<div id="overlay"></div>
</div>

<div id="panel">
<div class="section">
<b>ANCHOR H1 · MANUAL OHLC</b><br>
O <input id="o" size="7">
H <input id="h" size="7">
L <input id="l" size="7">
C <input id="c" size="7">
<button id="setAnchor">SET</button>
<div id="anchorState"></div>
</div>

<div class="section">
<b>MISSION / CONTEXT</b>
<div id="missionState" class="ctx"></div>
<div id="priorityTarget" class="info"></div>
<div id="strength" class="score"></div>
</div>

<div class="section">
<b>DECISION</b><br>
<button id="buy">BUY</button>
<button id="sell">SELL</button>
<div id="entryZone" class="zone hidden"></div>
<div id="lateWarning" class="warn hidden">RISIKO FLOATING BESAR</div>
<div id="cooldown" class="info hidden">COOLDOWN AKTIF</div>
</div>

<div id="reason" class="ctx hidden"></div>
</div>

<script>
/* ================= ORIGINAL ENGINE (TIDAK DIUBAH) ================= */
/* … SELURUH SCRIPT ENGINE ASLI TETAP SAMA … */
</script>

<!-- ================= ADD-ONLY: PRICE MISSION ASSIST ================= -->
<script>
/* … SCRIPT PRICE_MISSION_ASSIST TETAP SAMA … */
</script>

<!-- ================= ADD-ONLY: REAL BTCUSDT SPREAD FEED ================= -->
<script>
(function(){
  if(typeof window.currentSpread!=="number"){
    window.currentSpread=1;
  }

  let ws;
  function connect(){
    ws=new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@bookTicker");
    ws.onmessage=e=>{
      try{
        const d=JSON.parse(e.data);
        const bid=parseFloat(d.b);
        const ask=parseFloat(d.a);
        if(!isNaN(bid)&&!isNaN(ask)&&ask>bid){
          const s=Math.abs(ask-bid);
          if(s>0) window.currentSpread=s;
        }
      }catch(_){}
    };
    ws.onclose=()=>setTimeout(connect,3000);
    ws.onerror=()=>ws.close();
  }
  connect();
})();
</script>

</body>
</html>
